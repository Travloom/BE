<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>여행 추천 &amp; ChatGPT 팁</title>
  <style>
    body { font-family: Arial, sans-serif; padding:16px; background:#f9f9f9; }
    form { margin-bottom:24px; }
    .field-selector { position:relative; display:inline-block; margin:8px; }
    .field-selector label { display:block; margin-bottom:4px; font-weight:bold; }
    .field-selector input { width:120px; padding:6px; cursor:pointer; }
    .options { display:none; position:absolute; top:100%; left:0; background:#fff; border:1px solid #ccc; list-style:none; padding:0; margin:0; width:100%; z-index:10; }
    .field-selector:hover .options { display:block; }
    .options li { padding:8px; cursor:pointer; }
    .options li:hover { background:#f0f0f0; }
    button { padding:8px 16px; font-size:1rem; cursor:pointer; }

    /* 관광지 카드 */
    .attraction {
      background:#fff;
      padding:16px;
      border:1px solid #ddd;
      border-radius:8px;
      margin-bottom:16px;
    }
    .attraction h3 { margin:0 0 8px; }
    .attraction .address { margin:0 0 12px; color:#555; }
    .attraction .section-title { font-weight:bold; margin:8px 0 4px; }
    .attraction ul { margin:0 0 0 16px; padding:0; }
    .attraction li { margin-bottom:4px; }

    /* GPT 원본 응답 (디버깅/저장용) */
    .gpt-answer { display:none; }
  </style>
</head>
<body>
<h2>여행 추천 &amp; ChatGPT 팁</h2>

<!-- 검색 폼 -->
<form th:action="@{/places}" method="post">
  <!-- 지역 -->
  <div class="field-selector">
    <label>지역</label>
    <input type="text" name="region" th:value="${region}" placeholder="지역" readonly required/>
    <ul class="options">
      <li data-value="부산">부산</li>
      <li data-value="경주">경주</li>
      <li data-value="강릉">강릉</li>
      <li data-value="제주">제주</li>
      <li id="regionDirect">직접 입력</li>
    </ul>
  </div>
  <!-- 일정 -->
  <div class="field-selector">
    <label>일정</label>
    <input type="text" name="itinerary" th:value="${itinerary}" placeholder="일정" readonly required/>
    <ul class="options">
      <li data-value="1박2일">1박2일</li>
      <li data-value="2박3일">2박3일</li>
      <li data-value="3박4일">3박4일</li>
      <li data-value="4박5일">4박5일</li>
      <li id="itineraryDirect">직접 입력</li>
    </ul>
  </div>
  <!-- 예산 -->
  <div class="field-selector">
    <label>예산</label>
    <input type="text" name="budget" th:value="${budget}" placeholder="예산" readonly required/>
    <ul class="options">
      <li data-value="100,000원">100,000원</li>
      <li data-value="200,000원">200,000원</li>
      <li data-value="300,000원">300,000원</li>
      <li data-value="400,000원">400,000원</li>
      <li id="budgetDirect">직접 입력</li>
    </ul>
  </div>
  <!-- 인원 -->
  <div class="field-selector">
    <label>인원</label>
    <input type="text" name="people" th:value="${people}" placeholder="인원" readonly required/>
    <ul class="options">
      <li data-value="1">1</li>
      <li data-value="2">2</li>
      <li data-value="3">3</li>
      <li data-value="4">4</li>
      <li data-value="5">5</li>
      <li data-value="6">6</li>
      <li id="peopleDirect">직접 입력</li>
    </ul>
  </div>
  <!-- 누구와 -->
  <div class="field-selector">
    <label>누구와</label>
    <input type="text" name="companions" th:value="${companions}" placeholder="동행" readonly required/>
    <ul class="options">
      <li data-value="가족">가족</li>
      <li data-value="친구">친구</li>
      <li data-value="연인">연인</li>
      <li data-value="혼자">혼자</li>
      <li id="companionsDirect">직접 입력</li>
    </ul>
  </div>
  <!-- 테마 -->
  <div class="field-selector">
    <label>테마</label>
    <input type="text" name="theme" th:value="${theme}" placeholder="테마" readonly required/>
    <ul class="options">
      <li data-value="힐링">힐링</li>
      <li data-value="먹방">먹방</li>
      <li id="themeDirect">직접 입력</li>
    </ul>
  </div>

  <button type="submit">검색</button>
</form>

<!-- 각 관광지 카드 -->
<div th:each="a : ${attractions}" class="attraction">
  <h3 th:text="${a.name} + ' : ' + ${descriptions[a.name]}">
  </h3>
  <p class="address" th:text="'주소: ' + ${a.address}">
  </p>

  <p class="section-title">맛집 :</p>
  <ul>
    <li th:each="r : ${restaurantsNear[a.placeId]}"
        th:text="'• ' + ${r.name} + ' (' + ${r.rating} + '점, ' + ${r.address} + ')'">
    </li>
  </ul>

  <p class="section-title">카페 :</p>
  <ul>
    <li th:each="c : ${cafesNear[a.placeId]}"
        th:text="'• ' + ${c.name} + ' (' + ${c.rating} + '점, ' + ${c.address} + ')'">
    </li>
  </ul>
</div>

<!-- 저장 폼 -->
<h3>플랜 저장하기</h3>
<form th:action="@{/plans}" th:object="${planToSave}" method="post">
  <div>
    <label for="title">제목:</label>
    <input type="text" th:field="*{title}" id="title" required/>
  </div>
  <div style="margin-top:8px;">
    <label for="startDate">시작 날짜:</label>
    <input type="date" th:field="*{startDate}" id="startDate" required/>
  </div>
  <div style="margin-top:8px;">
    <label for="endDate">종료 날짜:</label>
    <input type="date" th:field="*{endDate}" id="endDate" required/>
  </div>
  <div style="margin-top:8px;">
    <label for="content">내용:</label><br/>
    <textarea th:field="*{content}" id="content" rows="10" cols="100" required></textarea>
  </div>
  <div style="margin-top:8px;">
    <button type="submit">저장하기</button>
    <a th:href="@{/places}"><button type="button">취소</button></a>
  </div>
</form>

<a th:href="@{/places}"><button>다시 검색</button></a>

<script>
  // “직접 입력” 옵션 처리
  document.querySelectorAll('.field-selector').forEach(fs => {
    const input = fs.querySelector('input');
    fs.querySelectorAll('li[data-value]').forEach(li => {
      li.addEventListener('click', () => {
        input.value = li.dataset.value;
        input.setAttribute('readonly','');
      });
    });
    const direct = fs.querySelector('li[id$="Direct"]');
    if (direct) {
      direct.addEventListener('click', () => {
        input.removeAttribute('readonly');
        input.value = '';
        input.focus();
        fs.querySelector('.options').style.display='none';
      });
    }
  });

  // 보인 내용을 textarea에 담기
  function fillPlanContent() {
    const lines = [];
    document.querySelectorAll('.attraction').forEach(card => {
      lines.push(card.querySelector('h3').innerText);
      lines.push(card.querySelector('.address').innerText);
      lines.push('맛집 :');
      card.querySelectorAll('ul')[0].querySelectorAll('li')
          .forEach(li => lines.push(li.innerText));
      lines.push('카페 :');
      card.querySelectorAll('ul')[1].querySelectorAll('li')
          .forEach(li => lines.push(li.innerText));
      lines.push('');
    });
    document.getElementById('content').value = lines.join('\n');
  }
  document.addEventListener('DOMContentLoaded', fillPlanContent);
</script>
</body>
</html>
